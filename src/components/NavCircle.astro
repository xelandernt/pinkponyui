---
import { COLORS, BLOG_NAV_CIRCLE_SIZE, BLOG_NAV_CIRCLE_EXPANDED_SIZE, BLOG_NAV_TRANSITION_DURATION } from '../consts';

interface Props {
	position: 'top-right' | 'top-left';
	href: string;
	text: string;
	color?: string;
}

const { position, href, text, color = COLORS.PRIMARY_PINK } = Astro.props;
---

<a href={href} class={`nav-circle ${position}`} data-color={color}>
	<svg class="circle-svg" viewBox="0 0 200 200">
		<defs>
			{/* Path for Blog (top-right) - reversed direction for upside-down text */}
			{position === 'top-right' && (
				<path 
					id={`circlePath-${position}`}
					d="M 100,25 A 75,75 0 1,0 100,175 A 75,75 0 1,0 100,25"
				/>
			)}
			{/* Path for Home (top-left) - normal direction */}
			{position === 'top-left' && (
				<path 
					id={`circlePath-${position}`}
					d="M 100,25 A 75,75 0 1,0 100,175 A 75,75 0 1,0 100,25"
				/>
			)}
		</defs>
		<circle cx="100" cy="100" r="100" fill={color} />
		<text class="nav-text">
			{/* For top-right (Blog): position at 62.5% with reversed path (flipped text) */}
			{/* For top-left (Home): position at 135% (wraps around to bottom-right) */}
			<textPath 
				href={`#circlePath-${position}`} 
				startOffset={position === 'top-right' ? '37.5%' : '62.5%'}
				text-anchor="middle"
			>
				{text}
			</textPath>
		</text>
	</svg>
</a>

<style define:vars={{ 
	primaryPink: COLORS.PRIMARY_PINK,
	white: COLORS.WHITE,
	circleSize: BLOG_NAV_CIRCLE_SIZE + 'px',
	expandedSize: BLOG_NAV_CIRCLE_EXPANDED_SIZE + 'px',
	transitionDuration: BLOG_NAV_TRANSITION_DURATION
}}>
	.nav-circle {
		position: fixed;
		width: var(--circleSize);
		height: var(--circleSize);
		z-index: 1000;
		cursor: pointer;
		transition: all var(--transitionDuration) ease;
		display: block;
		text-decoration: none;
		opacity: 0;
		transform: scale(0);
	}

	.nav-circle.top-right {
		top: calc(var(--circleSize) / -2);
		right: calc(var(--circleSize) / -2 + 12px); /* Account for 12px scrollbar width */
	}

	.nav-circle.top-left {
		top: calc(var(--circleSize) / -2);
		left: calc(var(--circleSize) / -2);
	}

	.nav-circle:hover {
		width: var(--expandedSize);
		height: var(--expandedSize);
	}

	.nav-circle.top-right:hover {
		top: calc(var(--expandedSize) / -2);
		right: calc(var(--expandedSize) / -2 + 12px); /* Account for 12px scrollbar width */
	}

	.nav-circle.top-left:hover {
		top: calc(var(--expandedSize) / -2);
		left: calc(var(--expandedSize) / -2);
	}

	.circle-svg {
		width: 100%;
		height: 100%;
	}

	.nav-text {
		fill: var(--white);
		font-family: "Lobster", cursive;
		font-size: 28px;
		font-weight: bold;
		letter-spacing: 2px;
	}

	/* Transition overlay for page transitions */
	.nav-circle.transitioning {
		pointer-events: none;
	}
</style>

<script>
	import { gsap } from 'gsap';

	document.addEventListener('DOMContentLoaded', () => {
		const navCircles = document.querySelectorAll('.nav-circle') as NodeListOf<HTMLElement>;
		
		navCircles.forEach((navCircle) => {
			// Entry animation: hidden -> expand -> normal
			gsap.timeline({ delay: 0.5 })
				.to(navCircle, {
					opacity: 1,
					scale: 1.5,
					duration: 0.4,
					ease: 'back.out(2)'
				})
				.to(navCircle, {
					scale: 1,
					duration: 0.3,
					ease: 'power2.inOut'
				});

			// Page transition animation on click
			navCircle.addEventListener('click', (e) => {
				e.preventDefault();
				const href = navCircle.getAttribute('href');
				if (!href) return;

				// Add transitioning class to prevent hover effects during transition
				navCircle.classList.add('transitioning');

				// Get the circle's color from data attribute
				const circleColor = navCircle.getAttribute('data-color');
				if (!circleColor) return;

				// Create a full-page overlay with the same color as the circle
				const overlay = document.createElement('div');
				overlay.style.position = 'fixed';
				overlay.style.top = '0';
				overlay.style.left = '0';
				overlay.style.width = '100%';
				overlay.style.height = '100%';
				overlay.style.backgroundColor = circleColor;
				overlay.style.transformOrigin = navCircle.classList.contains('top-right') 
					? 'top right' 
					: 'top left';
				overlay.style.transform = 'scale(0)';
				overlay.style.borderRadius = '50%';
				overlay.style.zIndex = '9999';
				overlay.style.pointerEvents = 'none';
				document.body.appendChild(overlay);

				// Animate the overlay to cover the page
				gsap.to(overlay, {
					scale: 10,
					duration: 0.8,
					ease: 'power2.inOut',
					onComplete: () => {
						// Navigate to the new page
						window.location.href = href;
					}
				});
			});
		});
	});
</script>
